<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Bill Details - Simple</title>
    <link href="styles/output.css" rel="stylesheet">
</head>
<body class="bg-gray-50 p-4">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">Bill Detail Debug (Simple)</h1>
        
        <div class="bg-white p-4 rounded shadow mb-4">
            <h2 class="text-lg font-semibold mb-2">Debug Information</h2>
            <div id="debug-info" class="space-y-2 text-sm font-mono"></div>
        </div>
        
        <div class="bg-white p-4 rounded shadow mb-4">
            <h2 class="text-lg font-semibold mb-2">Bill Content</h2>
            <div id="bill-content" class="text-sm"></div>
        </div>
        
        <div class="bg-white p-4 rounded shadow">
            <h2 class="text-lg font-semibold mb-2">Console Logs</h2>
            <div id="console-logs" class="text-xs font-mono bg-gray-100 p-2 rounded max-h-64 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const logsDiv = document.getElementById('console-logs');
        
        function addLog(type, message) {
            const logEntry = document.createElement('div');
            logEntry.className = `mb-1 ${type === 'error' ? 'text-red-600' : type === 'warn' ? 'text-yellow-600' : 'text-gray-700'}`;
            logEntry.textContent = `[${type.toUpperCase()}] ${new Date().toLocaleTimeString()}: ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('log', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('warn', args.join(' '));
        };
        
        // Debug info
        const debugInfo = document.getElementById('debug-info');
        const billContent = document.getElementById('bill-content');
        
        function addDebugInfo(label, value) {
            const info = document.createElement('div');
            info.innerHTML = `<strong>${label}:</strong> ${value}`;
            debugInfo.appendChild(info);
        }
        
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const billId = urlParams.get('id');
        
        addDebugInfo('URL', window.location.href);
        addDebugInfo('Bill ID from URL', billId || 'NOT FOUND');
        addDebugInfo('Decoded Bill ID', billId ? decodeURIComponent(billId) : 'N/A');
        
        console.log('Starting bill detail debug...');
        console.log('Bill ID:', billId);
        
        if (!billId) {
            billContent.innerHTML = '<div class="text-red-600">‚ùå No bill ID provided in URL</div>';
        } else {
            // Test API call
            console.log('Making API call to:', `/api/bills/${billId}`);
            
            billContent.innerHTML = '<div class="text-blue-600">üîÑ Loading bill details...</div>';
            
            fetch(`/api/bills/${encodeURIComponent(billId)}`)
                .then(response => {
                    console.log('Response status:', response.status);
                    console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                    
                    addDebugInfo('Response Status', response.status);
                    addDebugInfo('Response OK', response.ok);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return response.json();
                })
                .then(data => {
                    console.log('API Response:', data);
                    
                    addDebugInfo('API Success', data.success);
                    
                    if (data.success && data.data) {
                        const bill = data.data;
                        
                        addDebugInfo('Bill Number', bill.billNumber);
                        addDebugInfo('Bill Title', bill.shortTitle);
                        addDebugInfo('Bill Status', bill.status);
                        
                        billContent.innerHTML = `
                            <div class="space-y-4">
                                <div>
                                    <h3 class="font-semibold text-lg">${bill.billNumber}</h3>
                                    <p class="text-gray-600">${bill.shortTitle}</p>
                                </div>
                                
                                <div>
                                    <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                                        ${bill.status}
                                    </span>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium">Full Title:</h4>
                                    <p class="text-sm text-gray-700">${bill.fullTitle}</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium">Abstract:</h4>
                                    <p class="text-sm text-gray-700">${bill.abstract || 'No abstract available'}</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium">Sponsors:</h4>
                                    <p class="text-sm text-gray-700">
                                        ${bill.sponsors && bill.sponsors.length > 0 ? 
                                            bill.sponsors.map(s => s.name || s).join(', ') : 
                                            'No sponsors listed'}
                                    </p>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium">Raw Data:</h4>
                                    <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto">${JSON.stringify(bill, null, 2)}</pre>
                                </div>
                            </div>
                        `;
                        
                        console.log('‚úÖ Bill loaded successfully');
                    } else {
                        throw new Error('Invalid response format or no data');
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading bill:', error);
                    
                    addDebugInfo('Error', error.message);
                    
                    billContent.innerHTML = `
                        <div class="text-red-600">
                            <h3 class="font-semibold">‚ùå Error Loading Bill</h3>
                            <p class="text-sm mt-2">${error.message}</p>
                        </div>
                    `;
                });
        }
        
        // Test if dependencies are loaded
        setTimeout(() => {
            addDebugInfo('window.errorBoundary', typeof window.errorBoundary);
            addDebugInfo('window.enhancedFetch', typeof window.enhancedFetch);
            addDebugInfo('window.loadingManager', typeof window.loadingManager);
            addDebugInfo('window.billDetailApp', typeof window.billDetailApp);
        }, 1000);
    </script>
</body>
</html>